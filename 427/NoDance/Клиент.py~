from socket import *
from threading import Thread
import time as ti

# РљР»РёРµРЅС‚
class Client():
    def __init__(self): # Р—Р°РїСѓСЃРє РєР»РёРµРЅС‚Р°, РІРІРѕРґ РЅРёРєР°
        # вынести этот код в отдельный класс, где вся эта рутина будет вызываться одной строкой
        # например startClientSocket('localhost', self.port)
        self.host='127.0.0.1' ; self.port=3000 ; self.b_size=1024
        self.sockaddr=(self.host,self.port) ; self.title="Р’С‹Р№С‚Рё"
        self.client=socket(AF_INET,SOCK_DGRAM)
        #self.client.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
        self.nick=input("Р’РІРµРґРёС‚Рµ РЅРёРє: ")
        nick_msg="n_"+self.nick
        # это тоже вынести в что-то вроде connectToServer, где будут все необходимые сообщения серверу. Или делать это в том же startClientSocket
        self.client.sendto(nick_msg.encode('utf-8'),self.sockaddr)
        self.run=True
        
        
    def Look(self): # РџСЂРѕСЃРјРѕС‚СЂ С‡Р°С‚Р° РІ РѕС‚РґРµР»СЊРЅРѕРј РїРѕС‚РѕРєРµ
        while self.run:
            try:
                ti.sleep(0.1)
                # recieveMsg()
                data,addr = self.client.recvfrom(self.b_size)
                w_data=data.decode('utf-8')
                if w_data.startswith('*_'):
                    i=2 ;tmp=""
                    while i<len(w_data):
                        tmp+=w_data[i]
                        i+=1
                    w_data=tmp
                    print(w_data)
                    self.run=False
                else:
                    print(w_data)
                ti.sleep(0.1)
            except:
                pass
    
    def Chat(self): # РћС‚РїСЂР°РІРєР° СЃРѕРѕР±С‰РµРЅРёР№
        while self.run:
            data=input()
            # if isCommand(data): doCommand(data)
            if data.startswith('/Client.SwitchNick'):
                i=19 ; tmp=""
                while i<len(data):
                    tmp+=data[i]
                    i+=1
                data="sn_"+tmp
                self.client.sendto(data.encode('utf-8'),self.sockaddr)
                ti.sleep(0.1)
            else:
                d=data.encode('utf-8')
                self.client.sendto(d,self.sockaddr)
                if data.endswith('qqq'):
                    self.client.close()
                    self.run=False
                    ti.sleep(0.1)
a=Client()
Thread(target=a.Look).start()
Thread(target=a.Chat).start()
